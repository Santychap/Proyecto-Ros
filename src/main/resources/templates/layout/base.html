<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:fragment="layout(pageTitle, bodyFragment)">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${pageTitle}">Panel</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
        rel="stylesheet"/>

  <!-- TU CSS -->
  <link rel="stylesheet" th:href="@{/css/custom.css}"/>
</head>

<body>
<div class="d-flex" id="wrapper">

  <!-- Sidebar -->
  <nav id="sidebar-wrapper" class="bg-dark border-end">
    <div class="sidebar-heading text-center py-4 text-white fs-4 fw-bold">
      <i class="bi bi-shop me-2"></i>Olla y Sazón
    </div>

    <div class="list-group list-group-flush">

      <!-- ADMIN - Ve todo -->
      <div sec:authorize="hasRole('ADMINISTRADOR')">
        <!-- Sección de Gestión -->
        <div class="px-3 py-2">
          <small class="text-muted text-uppercase fw-bold">Gestión</small>
        </div>
        <a th:href="@{/users}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-people-fill me-2"></i>Usuarios
        </a>
        
        <!-- Sección de Catálogo -->
        <div class="px-3 py-2 mt-2">
          <small class="text-muted text-uppercase fw-bold">Catálogo</small>
        </div>
        <a th:href="@{/categorias}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-tags me-2"></i>Categorías
        </a>
        <a th:href="@{/productos}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-box me-2"></i>Productos
        </a>
        <a th:href="@{/promociones}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-percent me-2"></i>Promociones
        </a>
        <a th:href="@{/inventario}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-boxes me-2"></i>Inventario
        </a>
        
        <!-- Sección de Operaciones -->
        <div class="px-3 py-2 mt-2">
          <small class="text-muted text-uppercase fw-bold">Operaciones</small>
        </div>
        <a th:href="@{/mesas}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-table me-2"></i>Mesas
        </a>
        <a th:href="@{/reservas}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-calendar-check me-2"></i>Reservas
        </a>
        <a th:href="@{/pedidos}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-cart me-2"></i>Pedidos
        </a>
        <a th:href="@{/pagos}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-credit-card me-2"></i>Pagos
        </a>
        <a th:href="@{/horarios}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-clock me-2"></i>Horarios
        </a>
        <a th:href="@{/noticias}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-newspaper me-2"></i>Noticias
        </a>
        
        <!-- Sección de Reportes -->
        <div class="px-3 py-2 mt-2">
          <small class="text-muted text-uppercase fw-bold">Reportes</small>
        </div>
        <a th:href="@{/admin/reportes}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-graph-up me-2"></i>Reportes
        </a>
      </div>

      <!-- CLIENTE - Solo su perfil, pedidos, reservas y pagos -->
      <div sec:authorize="hasRole('CLIENTE')">
        <div class="px-3 py-2">
          <small class="text-muted text-uppercase fw-bold">Mi Cuenta</small>
        </div>
        <a th:href="@{/mi-perfil}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-person-circle me-2"></i>Mi Perfil
        </a>
        
        <div class="px-3 py-2 mt-2">
          <small class="text-muted text-uppercase fw-bold">Mis Servicios</small>
        </div>
        <a th:href="@{/mis-pedidos}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-cart me-2"></i>Mis Pedidos
        </a>
        <a th:href="@{/mis-reservas}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-calendar-check me-2"></i>Mis Reservas
        </a>
        <a th:href="@{/mis-pagos}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-credit-card me-2"></i>Mis Pagos
        </a>
      </div>

      <!-- EMPLEADO - Horarios y pedidos asignados -->
      <div sec:authorize="hasRole('EMPLEADO')">
        <div class="px-3 py-2">
          <small class="text-muted text-uppercase fw-bold">Mi Trabajo</small>
        </div>
        <a th:href="@{/mi-horario}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-clock me-2"></i>Mi Horario
        </a>
        <a th:href="@{/pedidos-asignados}" class="list-group-item list-group-item-action bg-dark text-white">
          <i class="bi bi-cart-check me-2"></i>Pedidos Asignados
        </a>
      </div>

    </div>
  </nav>

  <!-- Contenido principal -->
  <div id="page-content-wrapper" class="w-100">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-light border-bottom">
      <div class="container-fluid">

        <button class="btn btn-primary" id="menu-toggle">
          <i class="bi bi-list"></i>
        </button>

        <span class="navbar-text ms-3">
          <small th:text="${pageTitle}">Panel</small>
        </span>

        <div class="ms-auto d-flex align-items-center">
          <div class="dropdown me-3">
            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
              <i class="bi bi-person-circle me-1"></i>
              <span sec:authentication="name">Usuario</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><h6 class="dropdown-header">Cuenta</h6></li>
              <li sec:authorize="hasRole('CLIENTE')">
                <a class="dropdown-item" th:href="@{/mi-perfil}">
                  <i class="bi bi-person me-2"></i>Mi Perfil
                </a>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <form th:action="@{/logout}" method="post" class="d-inline w-100">
                  <button type="submit" class="dropdown-item text-danger">
                    <i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión
                  </button>
                </form>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <!-- BODY -->
    <div class="container-fluid mt-4">

      <!-- AQUÍ SE INSERTA EL CONTENIDO DE CADA VISTA -->
      <div th:insert="${bodyFragment}"></div>

      <div th:replace="fragments/footer :: footer"></div>

    </div>
  </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Toggle del sidebar -->
<script>
  document.getElementById('menu-toggle')
    .addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('wrapper').classList.toggle('toggled');
    });
</script>

</body>
</html>
